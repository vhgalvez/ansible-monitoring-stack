---
# playbook\05_update_scrape_targets.yml
# 5ï¸âƒ£ Generar configuraciÃ³n de scraping para nodos externos (extraScrapeConfigs.yaml)

- name: ğŸ“„ Generar archivo de scrape dinÃ¡mico para nodos externos
  hosts: controller
  connection: local
  gather_facts: false

  vars:
    output_path: "/tmp/prometheus_manifests/extraScrapeConfigs.yaml"
    template_src: "roles/prometheus/templates/extraScrapeConfigs.yaml.j2"

  tasks:

    - name: ğŸ“ Crear carpeta para manifests si no existe
      file:
        path: "{{ output_path | dirname }}"
        state: directory
        mode: '0755'

    - name: ğŸ§© Renderizar plantilla extraScrapeConfigs.yaml
      template:
        src: "{{ template_src }}"
        dest: "{{ output_path }}"

    - name: ğŸ“œ Mostrar resumen de ruta generada
      debug:
        msg: "âœ… Archivo de scrapes generado en {{ output_path }}"
