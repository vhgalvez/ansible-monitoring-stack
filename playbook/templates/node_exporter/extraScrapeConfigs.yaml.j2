# playbook/templates/node_exporter/extraScrapeConfigs.yaml.j2
# üîç Configuraci√≥n adicional de Prometheus para hacer scrape a nodos externos

{% if groups['external_node_exporter'] is defined and groups['external_node_exporter'] | length > 0 %}
- job_name: 'external-nodes'
  metrics_path: /metrics
  scrape_interval: 15s
  scrape_timeout: 10s
  scheme: http
  static_configs:
    - targets:
{% for host in groups['external_node_exporter'] | sort %}
{%   set ip = hostvars[host]['ansible_host'] | default(host) %}
      - '{{ ip }}:{{ node_exporter_port }}'
{% endfor %}
{% else %}
# ‚ö†Ô∏è No se detectaron nodos en el grupo 'external_node_exporter'.
# Verifica el inventario y aseg√∫rate de que el grupo est√© correctamente definido.
{% endif %}