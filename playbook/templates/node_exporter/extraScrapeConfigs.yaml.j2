# playbook\templates\node_exporter\extraScrapeConfigs.yaml.j2
scrape_configs:
  - job_name: 'node_exporter'
    static_configs:
      - targets:
        {% for host in groups['external_node_exporter'] %}
          {% if hostvars[host].ansible_facts.default_ipv4 is defined %}
            - "{{ hostvars[host].ansible_facts.default_ipv4.address }}:{{ node_exporter_port }}"
          {% else %}
            - "IP_NO_DISPONIBLE:{{ node_exporter_port }}"
          {% endif %}
        {% endfor %}