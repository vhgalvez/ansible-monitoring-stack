# playbook/templates/node_exporter/extraScrapeConfigs.yaml.j2
# üîç Configuraci√≥n adicional de Prometheus para hacer scrape a nodos externos

scrape_configs:
  - job_name: 'node_exporter'
    static_configs:
      - targets:
        {% for host in groups['external_node_exporter'] %}
          {% if hostvars[host].ansible_facts.default_ipv4 is defined %}
          - "{{ hostvars[host].ansible_facts.default_ipv4.address }}:{{ node_exporter_port }}"
          {% else %}
          - "IP_NO_DISPONIBLE:{{ node_exporter_port }}"  # En caso de que no haya IPv4
          {% endif %}
        {% endfor %}